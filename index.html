<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Smart Alarm</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body{
  font-family: Arial, sans-serif;
  background:#f2f4f8;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
.card{
  background:#fff;
  width:320px;
  padding:20px;
  border-radius:16px;
  box-shadow:0 10px 25px rgba(0,0,0,.15);
  text-align:center;
}
.clock{
  font-size:32px;
  color:#1e88e5;
  margin:10px 0;
}
select,button{
  width:100%;
  padding:10px;
  margin:6px 0;
  font-size:16px;
  border-radius:10px;
}
button{
  border:none;
  color:#fff;
  cursor:pointer;
}
.save{background:#3498db}
.on{background:#2ecc71}
.off{background:#e74c3c}
.sensor{
  margin-top:10px;
  text-align:left;
  font-size:14px;
}
</style>
</head>

<body>
<div class="card">
  <h2>â° Smart Alarm</h2>

  <!-- à¹€à¸§à¸¥à¸²à¹€à¸£à¸µà¸¢à¸¥à¹„à¸—à¸¡à¹Œ -->
  <div class="clock" id="time">--:--:--</div>

  <!-- à¸•à¸±à¹‰à¸‡à¹€à¸§à¸¥à¸² -->
  <select id="hour"></select>
  <select id="minute"></select>

  <button class="save" onclick="saveTime()">ğŸ’¾ à¸šà¸±à¸™à¸—à¸¶à¸à¹€à¸§à¸¥à¸²</button>
  <button class="on" onclick="setAlarm(true)">ğŸ”” à¹€à¸›à¸´à¸” Alarm</button>
  <button class="off" onclick="setAlarm(false)">â›” à¸›à¸´à¸” Alarm</button>

  <!-- Sensor -->
  <div class="sensor">
    ğŸŒ¡ à¸­à¸¸à¸“à¸«à¸ à¸¹à¸¡à¸´: <span id="temp">--</span> Â°C<br>
    ğŸ’§ à¸„à¸§à¸²à¸¡à¸Šà¸·à¹‰à¸™: <span id="hum">--</span> %<br>
    ğŸ’¡ à¹à¸ªà¸‡: <span id="light">--</span>
  </div>
</div>

<script>
// ================= Firebase Config =================
const firebaseConfig = {
  apiKey: "AIzaSyBCsuRaK7arhDgqYz4q2B73U0IoAR6yG9I",
  databaseURL: "smart-alarm-9c9ee-default-rtdb.asia-southeast1.firebasedatabase.app"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ================= à¸ªà¸£à¹‰à¸²à¸‡à¸•à¸±à¸§à¹€à¸¥à¸·à¸­à¸à¹€à¸§à¸¥à¸² =================
for(let i=0;i<24;i++){
  hour.innerHTML += `<option value="${i}">${String(i).padStart(2,'0')}</option>`;
}
for(let i=0;i<60;i++){
  minute.innerHTML += `<option value="${i}">${String(i).padStart(2,'0')}</option>`;
}

// ================= à¹à¸ªà¸”à¸‡à¹€à¸§à¸¥à¸² RTC =================
db.ref("time/current").on("value",snap=>{
  if(snap.exists()){
    document.getElementById("time").innerText = snap.val();
  }
});

// ================= à¸šà¸±à¸™à¸—à¸¶à¸à¹€à¸§à¸¥à¸² =================
function saveTime(){
  db.ref("alarm").update({
    hour: parseInt(hour.value),
    minute: parseInt(minute.value)
  });
}

// ================= à¹€à¸›à¸´à¸” / à¸›à¸´à¸” Alarm =================
function setAlarm(state){
  db.ref("alarm/enable").set(state);
}

// ================= à¹‚à¸«à¸¥à¸”à¸„à¹ˆà¸² Alarm =================
db.ref("alarm").on("value",snap=>{
  if(!snap.exists()) return;
  hour.value = snap.val().hour;
  minute.value = snap.val().minute;
});

// ================= Sensor =================
db.ref("sensor").on("value",snap=>{
  if(!snap.exists()) return;
  temp.innerText  = snap.val().temperature;
  hum.innerText   = snap.val().humidity;
  light.innerText = snap.val().light;
});
</script>
</body>
</html>
