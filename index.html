<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Smart Alarm</title>
<style>
body{font-family:sans-serif;background:#f4f6f8}
.card{background:#fff;padding:20px;margin:15px auto;width:320px;
border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,.1);text-align:center}
.time{font-size:40px;color:#2196f3;font-weight:bold}
button{width:100%;padding:12px;margin:6px;border:0;border-radius:8px;
font-size:16px;color:#fff;cursor:pointer}
.save{background:#2196f3}
.on{background:#4caf50}
.off{background:#f44336}
.status.on{color:red;font-weight:bold}
</style>
</head>
<body>

<div class="card">
  <h2>‚è∞ Smart Alarm</h2>
  <div class="time" id="time">--:--:--</div>
</div>

<div class="card">
  <select id="h"></select> :
  <select id="m"></select>
  <button class="save" onclick="save()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤</button>
  <button class="on" onclick="enable(true)">üîî ‡πÄ‡∏õ‡∏¥‡∏î Alarm</button>
  <button class="off" onclick="enable(false)">üîï ‡∏õ‡∏¥‡∏î Alarm</button>
</div>

<div class="card">
  <div id="status">‚è≥ ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</div>
</div>

<script type="module">
import {initializeApp} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import {getDatabase,ref,set,onValue} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const app = initializeApp({
  databaseURL:"https://smart-alarm-9c9ee-default-rtdb.asia-southeast1.firebasedatabase.app"
});
const db = getDatabase(app);

let H=0,M=0,S=0;

// ‡πÄ‡∏î‡∏¥‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏≠‡∏á‡∏ó‡∏∏‡∏Å 1 ‡∏ß‡∏¥
setInterval(()=>{
  S++; if(S>=60){S=0;M++;} if(M>=60){M=0;H++;} if(H>=24)H=0;
  document.getElementById("time").innerText=
  `${String(H).padStart(2,'0')}:${String(M).padStart(2,'0')}:${String(S).padStart(2,'0')}`;
},1000);

// sync ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
onValue(ref(db,"time/current"),s=>{
  if(!s.val())return;
  [H,M,S]=s.val().split(":").map(Number);
});

// alarm status
onValue(ref(db,"status/alarm_triggered"),s=>{
  document.getElementById("status").innerHTML =
    s.val() ? "üö® ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô!!!" : "‚è≥ ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô";
  document.getElementById("status").className =
    s.val() ? "status on" : "status";
});

for(let i=0;i<24;i++)h.innerHTML+=`<option>${i}</option>`;
for(let i=0;i<60;i++)m.innerHTML+=`<option>${i}</option>`;

window.save=()=>{
  set(ref(db,"/alarm/hour"),+h.value);
  set(ref(db,"/alarm/minute"),+m.value);
};
window.enable=v=>set(ref(db,"/alarm/enable"),v);
</script>
</body>
</html>
