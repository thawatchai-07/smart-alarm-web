<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>Smart Alarm</title>

  <!-- Firebase v9 -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

    // üîπ Firebase config ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    const firebaseConfig = {
      databaseURL: "https://smart-alarm-9c9ee-default-rtdb.asia-southeast1.firebasedatabase.app"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // ====== DOM ======
    const tempEl = document.getElementById("temp");
    const humEl = document.getElementById("hum");
    const lightEl = document.getElementById("light");
    const statusEl = document.getElementById("alarmStatus");

    const hourSel = document.getElementById("hour");
    const minSel = document.getElementById("minute");

    // ====== ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤ Sensor ======
    onValue(ref(db, "sensor"), (snap) => {
      if (snap.exists()) {
        const d = snap.val();
        tempEl.innerText = d.temperature + " ¬∞C";
        humEl.innerText = d.humidity + " %";
        lightEl.innerText = d.light;
      }
    });

    // ====== ‡∏≠‡πà‡∏≤‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Alarm ======
    onValue(ref(db, "alarm"), (snap) => {
      if (snap.exists()) {
        const d = snap.val();
        hourSel.value = String(d.hour).padStart(2, "0");
        minSel.value = String(d.minute).padStart(2, "0");
        statusEl.innerText = d.enable ? "‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô" : "‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà";
      }
    });

    // ====== ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤ ======
    window.saveAlarm = () => {
      set(ref(db, "alarm"), {
        hour: Number(hourSel.value),
        minute: Number(minSel.value),
        enable: true,
        mode: "normal"
      });
      alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡πâ‡∏ß");
    };

    window.enableAlarm = () => {
      set(ref(db, "alarm/enable"), true);
    };

    window.disableAlarm = () => {
      set(ref(db, "alarm/enable"), false);
    };
  </script>

  <style>
    body { font-family: sans-serif; background:#f5f5f5 }
    .box { background:#fff; width:300px; margin:20px auto; padding:15px; border-radius:10px }
    select, button { width:100%; margin-top:8px; padding:6px }
  </style>
</head>

<body>

<h2 style="text-align:center">‚è∞ Smart Alarm</h2>

<div class="box">
  <b>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤ Alarm</b><br>
  <select id="hour"></select> :
  <select id="minute"></select>

  <button onclick="saveAlarm()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤</button>
  <button onclick="enableAlarm()">‡πÄ‡∏õ‡∏¥‡∏î Alarm</button>
  <button onclick="disableAlarm()">‡∏õ‡∏¥‡∏î Alarm</button>
</div>

<div class="box">
  <b>‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö</b><br>
  üå° ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥: <span id="temp">-</span><br>
  üíß ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô: <span id="hum">-</span><br>
  üí° ‡πÅ‡∏™‡∏á: <span id="light">-</span>
</div>

<div class="box">
  <b>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Alarm</b><br>
  <span id="alarmStatus">-</span>
</div>

<script>
  // ‡πÄ‡∏ï‡∏¥‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤
  const h = document.getElementById("hour");
  const m = document.getElementById("minute");

  for (let i = 0; i < 24; i++)
    h.innerHTML += `<option value="${String(i).padStart(2,'0')}">${String(i).padStart(2,'0')}</option>`;

  for (let i = 0; i < 60; i++)
    m.innerHTML += `<option value="${String(i).padStart(2,'0')}">${String(i).padStart(2,'0')}</option>`;
</script>

</body>
</html>
