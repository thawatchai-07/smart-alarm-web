<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Smart Alarm</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body{
  font-family: Arial, sans-serif;
  background:#f2f4f8;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
.card{
  background:#fff;
  width:320px;
  padding:20px;
  border-radius:16px;
  box-shadow:0 10px 25px rgba(0,0,0,.15);
  text-align:center;
}
.clock{
  font-size:32px;
  color:#1e88e5;
  margin:10px 0;
}
input,button{
  width:100%;
  padding:10px;
  margin:6px 0;
  font-size:16px;
  border-radius:10px;
}
button{
  border:none;
  color:#fff;
  cursor:pointer;
}
.save{background:#3498db}
.on{background:#2ecc71}
.off{background:#e74c3c}
.sensor{
  margin-top:10px;
  text-align:left;
  font-size:14px;
}
</style>
</head>

<body>
<div class="card">
  <h2>‚è∞ Smart Alarm</h2>

  <!-- ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå -->
  <div class="clock" id="time">--:--:--</div>

  <!-- ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏ö‡∏ö‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏• -->
  <input type="time" id="alarmTime">

  <button class="save" onclick="saveTime()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤</button>
  <button class="on" onclick="setAlarm(true)">‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö Alarm</button>
  <button class="off" onclick="setAlarm(false)">‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö Alarm</button>

<!-- ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Alarm -->
<div id="alarmStatus" style="margin-top:10px;font-weight:bold;">
  ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Alarm: --
</div>
<!-- ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå -->
<div id="detectStatus" style="margin-top:6px;font-size:14px;">
  ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö: --
</div>

  <!-- Sensor -->
  <div class="sensor">
    üå° ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥: <span id="temp">--</span> ¬∞C<br>
    üíß ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô: <span id="hum">--</span> %<br>
    üí° ‡πÅ‡∏™‡∏á: <span id="light">--</span>
  </div>
</div>

<script>
// ================= Firebase Config =================
const firebaseConfig = {
  apiKey: "AIzaSyBCsuRaK7arhDgqYz4q2B73U0IoAR6yG9I",
  databaseURL: "smart-alarm-9c9ee-default-rtdb.asia-southeast1.firebasedatabase.app"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ================= ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ß‡∏•‡∏≤ RTC =================
db.ref("time/current").on("value", snap => {
  if(snap.exists()){
    document.getElementById("time").innerText = snap.val();
  }
});

// ================= ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤ =================
function saveTime(){
  const time = document.getElementById("alarmTime").value;

  if(!time){
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡πà‡∏≠‡∏ô");
    return;
  }

  const [hour, minute] = time.split(":");

  db.ref("alarm").update({
    hour: parseInt(hour),
    minute: parseInt(minute)
  });

  alert("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
}

// ================= ‡πÄ‡∏õ‡∏¥‡∏î / ‡∏õ‡∏¥‡∏î Alarm =================
function setAlarm(state){
  db.ref("alarm/enable").set(state);
  alert(state ? "‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö Alarm ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à" : "‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö Alarm ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
}

// ================= ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡πà‡∏≤ Alarm =================
db.ref("alarm").on("value", snap => {
  if(!snap.exists()) return;

  const h = String(snap.val().hour).padStart(2,'0');
  const m = String(snap.val().minute).padStart(2,'0');
  document.getElementById("alarmTime").value = `${h}:${m}`;
});

// ================= Sensor =================
db.ref("sensor").on("value", snap => {
  if(!snap.exists()) return;
  const s = snap.val();
  temp.innerText  = s.temperature ?? "--";
  hum.innerText   = s.humidity ?? "--";
  light.innerText = s.light ?? "--";
});

  // ================= ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Alarm =================
db.ref("alarm/enable").on("value", snap => {
  const statusDiv = document.getElementById("alarmStatus");

  if(snap.val() === true){
    statusDiv.innerHTML = "üü¢ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Alarm: ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô";
    statusDiv.style.color = "#2ecc71";
  }else{
    statusDiv.innerHTML = "üî¥ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Alarm: ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà";
    statusDiv.style.color = "#e74c3c";
  }
});

</script>
</body>
</html>
