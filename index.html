<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Smart Alarm Control</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family: Arial, sans-serif;
  background:#f4f6f8;
  margin:0;
  padding:20px;
}
h1{
  text-align:center;
}
.container{
  max-width:500px;
  margin:auto;
}
.box{
  background:#fff;
  padding:15px;
  margin:10px 0;
  border-radius:10px;
  box-shadow:0 2px 6px rgba(0,0,0,.1);
}
button{
  width:100%;
  padding:10px;
  margin-top:5px;
  font-size:16px;
}
select{
  font-size:24px;
}
.status{
  font-weight:bold;
}
</style>
</head>

<body>
<h1>‚è∞ Smart Alarm</h1>

<div class="container">

  <!-- ‡πÄ‡∏ß‡∏•‡∏≤ -->
  <div class="box">
    <b>‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</b><br>
    <span id="nowTime" style="font-size:28px">--:--:--</span>
  </div>

  <!-- Alarm -->
  <div class="box">
    <b>‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤ Alarm</b><br><br>
    <div style="text-align:center;font-size:28px">
      <select id="hour"></select> :
      <select id="minute"></select>
    </div>
    <button onclick="saveAlarm()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤</button>
    <button onclick="enableAlarm()">‡πÄ‡∏õ‡∏¥‡∏î Alarm</button>
    <button onclick="disableAlarm()">‡∏õ‡∏¥‡∏î Alarm</button>
    <p>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Alarm :
      <span id="alarmStatus" class="status">--</span>
    </p>
  </div>

  <!-- Sensor -->
  <div class="box">
    <b>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå</b>
    <p>üå° ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥: <span id="temp">--</span></p>
    <p>üíß ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô: <span id="hum">--</span></p>
    <p>üí° ‡πÅ‡∏™‡∏á: <span id="light">--</span></p>
  </div>

  <!-- Alarm State -->
  <div class="box">
    <b>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</b><br>
    <span id="alarmDone">--</span>
  </div>

</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

/* üîß ‡πÅ‡∏Å‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ databaseURL ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì */
const firebaseConfig = {
  databaseURL: "https://smart-alarm-9c9ee-default-rtdb.asia-southeast1.firebasedatabase.app"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* ===== real time clock ===== */
function updateClock(){
  const now = new Date();
  const h = String(now.getHours()).padStart(2,"0");
  const m = String(now.getMinutes()).padStart(2,"0");
  const s = String(now.getSeconds()).padStart(2,"0");
  document.getElementById("nowTime").innerText = `${h}:${m}:${s}`;
}
setInterval(updateClock,1000);
updateClock();

/* ===== select option ===== */
const hourSel = document.getElementById("hour");
const minSel  = document.getElementById("minute");

for(let i=0;i<24;i++){
  const v = String(i).padStart(2,"0");
  hourSel.innerHTML += `<option value="${v}">${v}</option>`;
}
for(let i=0;i<60;i++){
  const v = String(i).padStart(2,"0");
  minSel.innerHTML += `<option value="${v}">${v}</option>`;
}

/* ===== read sensor ===== */
onValue(ref(db,"sensor"), snap=>{
  if(!snap.exists()) return;
  const d = snap.val();
  document.getElementById("temp").innerText  = d.temperature + " ¬∞C";
  document.getElementById("hum").innerText   = d.humidity + " %";
  document.getElementById("light").innerText = d.light;
});

/* ===== read alarm ===== */
onValue(ref(db,"alarm"), snap=>{
  if(!snap.exists()) return;
  const a = snap.val();
  hourSel.value = String(a.hour).padStart(2,"0");
  minSel.value  = String(a.minute).padStart(2,"0");
  document.getElementById("alarmStatus").innerText =
    a.enable ? "‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô" : "‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà";
  document.getElementById("alarmDone").innerText =
    a.done ? "‚è∞ Alarm ‡∏î‡∏±‡∏á‡πÅ‡∏•‡πâ‡∏ß" : "‡∏£‡∏≠‡πÄ‡∏ß‡∏•‡∏≤";
});

/* ===== buttons ===== */
window.saveAlarm = ()=>{
  update(ref(db,"alarm"),{
    hour:Number(hourSel.value),
    minute:Number(minSel.value),
    done:false
  });
};

window.enableAlarm  = ()=>update(ref(db,"alarm"),{enable:true});
window.disableAlarm = ()=>update(ref(db,"alarm"),{enable:false});

</script>
</body>
</html>
