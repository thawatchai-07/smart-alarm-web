<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Smart Alarm Control</title>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  databaseURL: "https://smart-alarm-9c9ee-default-rtdb.asia-southeast1.firebasedatabase.app"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// ===== Time =====
onValue(ref(db, "time/current"), s => {
  document.getElementById("time").innerText = s.val() || "--:--:--";
});

// ===== Sensor =====
onValue(ref(db, "sensor"), s => {
  const d = s.val() || {};
  document.getElementById("temp").innerText = d.temperature ?? "-";
  document.getElementById("hum").innerText = d.humidity ?? "-";
  document.getElementById("light").innerText = d.light ?? "-";
});

// ===== Alarm Status =====
onValue(ref(db, "status/alarm_triggered"), s => {
  document.getElementById("status").innerText =
    s.val() ? "üö® ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà !!!" : "‚è≥ ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô";
});

// ===== Buttons =====
window.saveAlarm = () => {
  set(ref(db, "alarm/hour"), parseInt(hour.value));
  set(ref(db, "alarm/minute"), parseInt(min.value));
};

window.enableAlarm = () => set(ref(db, "alarm/enable"), true);
window.disableAlarm = () => set(ref(db, "alarm/enable"), false);
</script>

<style>
body { font-family: sans-serif; background:#f4f4f4; }
.card { background:white; padding:20px; margin:15px auto; width:300px; border-radius:10px; }
button { width:100%; padding:10px; margin-top:8px; }
</style>
</head>

<body>

<div class="card">
  <h3>‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</h3>
  <h1 id="time">--:--:--</h1>
</div>

<div class="card">
  <h3>‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤ Alarm</h3>
  <select id="hour">
    <script>for(let i=0;i<24;i++)document.write(`<option>${i}</option>`)</script>
  </select> :
  <select id="min">
    <script>for(let i=0;i<60;i++)document.write(`<option>${i}</option>`)</script>
  </select>

  <button onclick="saveAlarm()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤</button>
  <button onclick="enableAlarm()">‡πÄ‡∏õ‡∏¥‡∏î Alarm</button>
  <button onclick="disableAlarm()">‡∏õ‡∏¥‡∏î Alarm</button>

  <p id="status">‚è≥ ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</p>
</div>

<div class="card">
  <h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå</h3>
  üå°Ô∏è <span id="temp"></span> ¬∞C<br>
  üíß <span id="hum"></span> %<br>
  üí° <span id="light"></span>
</div>

</body>
</html>
