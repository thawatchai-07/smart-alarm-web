<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Smart Alarm</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  font-family: sans-serif;
  max-width: 420px;
  margin: auto;
  background: #f2f2f2;
}
h1 {
  text-align: center;
}
.card {
  background: white;
  padding: 15px;
  margin: 10px 0;
  border-radius: 10px;
}
.row {
  display: flex;
  gap: 10px;
}
select, button {
  width: 100%;
  padding: 8px;
  font-size: 16px;
}
.unit {
  width: 80px;
  text-align: center;
  line-height: 40px;
}
canvas {
  margin-top: 10px;
}
</style>
</head>

<body>

<h1>‚è∞ Smart Alarm</h1>

<div class="card">
  <b>‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</b>
  <div id="now">--:--:--</div>
</div>

<div class="card">
  <b>‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤ Alarm</b>

  <div class="row">
    <select id="hour"></select>
    <div class="unit">(‡πÇ‡∏°‡∏á)</div>
  </div>

  <div class="row">
    <select id="minute"></select>
    <div class="unit">(‡∏ô‡∏≤‡∏ó‡∏µ)</div>
  </div>

  <button onclick="setAlarm()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤</button>
  <button onclick="alarmOn()">‡πÄ‡∏õ‡∏¥‡∏î Alarm</button>
  <button onclick="alarmOff()">‡∏õ‡∏¥‡∏î Alarm</button>
</div>

<div class="card">
  <b>‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö</b>
  <div>üå° ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥: <span id="temp">0</span> ¬∞C</div>
  <div>üíß ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô: <span id="hum">0</span> %</div>
  <div>üí° ‡πÅ‡∏™‡∏á: <span id="light">0</span></div>
</div>

<div class="card">
  <b>‡∏Å‡∏£‡∏≤‡∏ü‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥</b>
  <canvas id="tempChart"></canvas>
</div>

<div class="card">
  <b>‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏™‡∏á</b>
  <canvas id="lightChart"></canvas>
</div>

<div class="card">
  <b>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Alarm</b>
  <div id="status">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏î‡∏±‡∏á</div>
</div>

<script>
/* ===== Firebase config ===== */
var firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  databaseURL: "https://YOUR_PROJECT.firebaseio.com",
  projectId: "YOUR_PROJECT"
};
firebase.initializeApp(firebaseConfig);
var db = firebase.database();

/* ===== dropdown ===== */
const hourSel = document.getElementById("hour");
const minSel = document.getElementById("minute");

for (let i = 0; i < 24; i++)
  hourSel.innerHTML += `<option value="${i}">${i}</option>`;
for (let i = 0; i < 60; i++)
  minSel.innerHTML += `<option value="${i}">${i}</option>`;

/* ===== charts ===== */
let labels = [];
let tempData = [];
let lightData = [];

const tempChart = new Chart(
  document.getElementById("tempChart"),
  {
    type: "line",
    data: {
      labels,
      datasets: [{
        label: "‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ (¬∞C)",
        data: tempData,
        borderColor: "red",
        fill: false
      }]
    }
  }
);

const lightChart = new Chart(
  document.getElementById("lightChart"),
  {
    type: "line",
    data: {
      labels,
      datasets: [{
        label: "‡πÅ‡∏™‡∏á",
        data: lightData,
        borderColor: "orange",
        fill: false
      }]
    }
  }
);

/* ===== realtime data ===== */
db.ref("sensor").on("value", s => {
  const d = s.val();
  if (!d) return;

  document.getElementById("temp").innerText = d.temperature;
  document.getElementById("hum").innerText = d.humidity;
  document.getElementById("light").innerText = d.light;

  const time = new Date().toLocaleTimeString();
  labels.push(time);
  tempData.push(d.temperature);
  lightData.push(d.light);

  if (labels.length > 10) {
    labels.shift();
    tempData.shift();
    lightData.shift();
  }

  tempChart.update();
  lightChart.update();
});

db.ref("time").on("value", s => {
  document.getElementById("now").innerText = s.val() || "--:--:--";
});

db.ref("status/alarm_triggered").on("value", s => {
  document.getElementById("status").innerText =
    s.val() ? "‚è∞ Alarm ‡∏î‡∏±‡∏á‡πÅ‡∏•‡πâ‡∏ß" : "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏î‡∏±‡∏á";
});

/* ===== control ===== */
function setAlarm() {
  db.ref("alarm").update({
    hour: Number(hourSel.value),
    minute: Number(minSel.value)
  });
  alert("‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
}
function alarmOn() {
  db.ref("alarm/enable").set(true);
}
function alarmOff() {
  db.ref("alarm/enable").set(false);
}
</script>

</body>
</html>
